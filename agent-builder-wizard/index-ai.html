<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Agent Builder Wizard - PM Agent Squad Master</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="td-theme.css">
    <style>
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
        .step-indicator {
            opacity: 0.5;
        }
        .step-indicator.active {
            opacity: 1;
        }
        .step-indicator.completed {
            opacity: 1;
        }
        .kb-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .ai-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #6366f1;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
    <!-- API Key Configuration Modal -->
    <div id="apiKeyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-900 mb-4">üîë Configure Live Claude AI</h3>
            <p class="text-sm text-gray-600 mb-4">
                To use live AI responses, enter your Anthropic API key. Your key is stored securely in your browser session only.
            </p>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Anthropic API Key
                </label>
                <input
                    type="password"
                    id="apiKeyInput"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder="sk-ant-..."
                />
                <p class="text-xs text-gray-500 mt-2">
                    Get your API key from <a href="https://console.anthropic.com/" target="_blank" class="text-indigo-600 hover:underline">console.anthropic.com</a>
                </p>
            </div>

            <div class="flex gap-3">
                <button
                    id="saveApiKeyBtn"
                    class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                >
                    Save & Enable Live AI
                </button>
                <button
                    id="skipApiKeyBtn"
                    class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition-colors"
                >
                    Skip (Use Demo Mode)
                </button>
            </div>

            <p class="text-xs text-gray-500 mt-4">
                Demo mode uses keyword-based responses. For best results, use live AI with your API key.
            </p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center gap-3 mb-2">
                <img src="favicon.ico" alt="Treasure Data" class="w-12 h-12">
                <h1 class="text-4xl font-bold text-indigo-900">AI-Powered Agent Builder</h1>
            </div>
            <p class="text-gray-600">Describe your agent, and I'll help you build it step-by-step</p>
            <div class="flex items-center justify-center gap-4 mt-2">
                <p class="text-sm text-gray-500">Powered by Claude Code AI ‚Ä¢ PM Agent Squad Master Template</p>
                <button
                    id="configureApiBtn"
                    class="text-xs bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-3 py-1 rounded-full transition-colors"
                    title="Configure API Key"
                >
                    <span id="apiStatusIndicator">üî¥</span> API Settings
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Side: AI Assistant Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                    <div class="flex items-center gap-2 mb-4 pb-4 border-b border-gray-200">
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center p-1 shadow-sm border border-gray-200">
                            <img src="favicon.ico" alt="TD" class="w-full h-full">
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-900">Agent Foundry Assistant</h3>
                            <p class="text-xs text-gray-500">Your agent building assistant</p>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div id="aiChatMessages" class="space-y-4 mb-4 max-h-96 overflow-y-auto">
                        <!-- Initial message -->
                        <div class="ai-message bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg p-4 border border-indigo-100">
                            <p class="text-sm text-gray-800">
                                üëã Hi! I'm your Agent Foundry Assistant. I'll help you build a custom AI Foundry Agent.
                                <br><br>
                                <strong>Let's start:</strong> What kind of agent do you want to build? Describe what it should do.
                            </p>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="space-y-2">
                        <textarea
                            id="aiChatInput"
                            rows="3"
                            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                            placeholder="Example: I want to build a campaign planning agent that helps marketers create comprehensive marketing campaigns across multiple channels..."
                        ></textarea>
                        <button
                            id="aiSendBtn"
                            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                        >
                            Send to Claude
                        </button>
                        <button
                            id="aiGenerateBtn"
                            class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200"
                        >
                            ‚ú® Auto-Generate Agent
                        </button>
                        <button
                            id="cancelGenerateBtn"
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                            style="display: none;"
                        >
                            ‚úñÔ∏è Cancel Generation
                        </button>
                        <button
                            id="resetBtn"
                            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                        >
                            üîÑ Start Over
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <p class="text-xs font-semibold text-gray-600 mb-2">Quick Examples:</p>
                        <div class="space-y-2">
                            <button class="quick-example w-full text-left text-xs bg-gray-50 hover:bg-gray-100 rounded px-3 py-2 transition-colors" data-example="campaign-building">
                                üéØ Campaign Building
                            </button>
                            <button class="quick-example w-full text-left text-xs bg-gray-50 hover:bg-gray-100 rounded px-3 py-2 transition-colors" data-example="campaign-optimization">
                                üìä Campaign Optimization
                            </button>
                            <button class="quick-example w-full text-left text-xs bg-gray-50 hover:bg-gray-100 rounded px-3 py-2 transition-colors" data-example="campaign-reporting">
                                üìà Campaign Reporting
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Wizard Steps -->
            <div class="lg:col-span-2">
                <!-- Progress Steps -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="step-indicator active flex-1 text-center" data-step="0">
                            <div class="w-8 h-8 mx-auto bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">0</div>
                            <p class="text-xs font-medium">Describe</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center" data-step="1">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">1</div>
                            <p class="text-xs font-medium">Knowledge</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center" data-step="2">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">2</div>
                            <p class="text-xs font-medium">Project</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center" data-step="3">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">3</div>
                            <p class="text-xs font-medium">Agent</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center" data-step="4">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">4</div>
                            <p class="text-xs font-medium">Deploy</p>
                        </div>
                    </div>
                </div>

                <!-- Main Content Card -->
                <div class="bg-white rounded-lg shadow-lg p-8">

                    <!-- Step 0: Describe Your Agent (NEW AI-First Step) -->
                    <div class="step-content active" data-step="0">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">üéØ Step 0: Describe Your Agent</h2>

                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-l-4 border-indigo-500 p-4 mb-6">
                            <p class="text-sm text-indigo-900">
                                <strong>AI-Powered Building:</strong> Tell Claude what your agent needs to do, and it will automatically generate knowledge bases, configuration, and deployment files for you.
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    What is your agent's purpose? <span class="text-red-500">*</span>
                                </label>
                                <textarea
                                    id="agentDescription"
                                    rows="6"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Example: I need a campaign planning agent that helps marketers with:
- Creating comprehensive marketing campaign strategies
- Planning multi-channel campaigns (Meta, Google, TikTok, Pinterest)
- Optimizing campaign performance and budget allocation
- Analyzing campaign metrics and generating reports
- Providing best practices for paid media advertising

The agent should be strategic, data-driven, and provide actionable recommendations based on campaign planning frameworks and advertising best practices."
                                ></textarea>
                                <p class="text-xs text-gray-500 mt-1">
                                    Be specific! Include what the agent should do, who will use it, and what knowledge it needs.
                                </p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    What tone should your agent have?
                                </label>
                                <select id="agentTone" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="professional">Professional & Formal</option>
                                    <option value="friendly">Friendly & Conversational</option>
                                    <option value="empathetic">Empathetic & Supportive</option>
                                    <option value="technical">Technical & Precise</option>
                                    <option value="enthusiastic">Enthusiastic & Energetic</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Who will use this agent?
                                </label>
                                <input
                                    type="text"
                                    id="agentAudience"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Example: Company employees, customers, internal team members..."
                                />
                            </div>

                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <p class="text-sm text-yellow-900">
                                    <strong>üí° Tip:</strong> The more detail you provide, the better Claude can generate your agent configuration. Include specific examples of questions users might ask or tasks they need help with.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1: Knowledge Bases (AI-Generated) -->
                    <div class="step-content" data-step="1">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">üìö Step 1: Review Knowledge Bases</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900">
                                <strong>‚ú® AI-Generated:</strong> Based on your description, Claude has created these knowledge bases for your agent. Review and edit as needed.
                            </p>
                        </div>

                        <div id="knowledgeBasesList" class="space-y-4">
                            <!-- AI-generated KBs will be inserted here -->
                            <div class="text-center py-12 text-gray-400">
                                <p>Complete Step 0 to generate knowledge bases</p>
                            </div>
                        </div>

                        <button
                            id="addKBBtn"
                            class="mt-4 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                        >
                            ‚ûï Add Another Knowledge Base
                        </button>
                    </div>

                    <!-- Step 2: Project Setup (AI-Generated) -->
                    <div class="step-content" data-step="2">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">‚öôÔ∏è Step 2: Review Project Setup</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900">
                                <strong>‚ú® AI-Generated:</strong> Claude has configured your project settings. Review and modify if needed.
                            </p>
                            <p class="text-sm text-green-900 mt-2">
                                <strong>üìç Next Step:</strong> After completing this wizard, open <a href="https://console.treasuredata.com/app/agents" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline font-semibold">Treasure Data ‚Üí AI Agent Foundry</a> to deploy your agent.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Project Name <span class="text-red-500">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="projectName"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Example: Employee HR Support System"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Project Description <span class="text-red-500">*</span>
                                </label>
                                <textarea
                                    id="projectDescription"
                                    rows="4"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Comprehensive description of your project..."
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Agent Configuration (AI-Generated) -->
                    <div class="step-content" data-step="3">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">ü§ñ Step 3: Review Agent Configuration</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900">
                                <strong>‚ú® AI-Generated:</strong> Claude has selected optimal settings for your agent. Customize if needed.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Agent Display Name <span class="text-red-500">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="agentName"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    AI Model <span class="text-red-500">*</span>
                                </label>
                                <select id="modelSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="anthropic.claude-3-5-sonnet-20241022-v2:0">Claude 3.5 Sonnet v2 (Recommended)</option>
                                    <option value="anthropic.claude-3-5-haiku-20241022-v1:0">Claude 3.5 Haiku</option>
                                    <option value="anthropic.claude-3-opus-20240229-v1:0">Claude 3 Opus</option>
                                    <option value="openai.gpt-4o">GPT-4o</option>
                                    <option value="openai.gpt-4o-mini">GPT-4o Mini</option>
                                    <option value="amazon.nova-pro-v1:0">Amazon Nova Pro</option>
                                    <option value="amazon.nova-lite-v1:0">Amazon Nova Lite</option>
                                    <option value="meta.llama3-1-405b-instruct-v1:0">Llama 3.1 405B</option>
                                </select>
                                <p id="modelRecommendation" class="text-xs text-indigo-600 mt-1"></p>

                                <!-- AI Model Reasoning -->
                                <div id="modelReasoningSection" class="mt-3 p-3 bg-indigo-50 border border-indigo-200 rounded-lg" style="display: none;">
                                    <div class="flex items-start gap-2">
                                        <span class="text-indigo-600 text-sm">üí°</span>
                                        <div>
                                            <p class="text-xs font-semibold text-indigo-900 mb-1">Why this model?</p>
                                            <p id="modelReasoningText" class="text-xs text-indigo-700"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Temperature: <span id="tempValue" class="text-indigo-600 font-semibold">0.5</span>
                                </label>
                                <input
                                    type="range"
                                    id="temperature"
                                    min="0"
                                    max="1"
                                    step="0.1"
                                    value="0.5"
                                    class="w-full"
                                />
                                <p class="text-xs text-gray-500 mt-1">
                                    Lower = More precise and consistent | Higher = More creative and varied
                                </p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    System Prompt <span class="text-red-500">*</span>
                                </label>
                                <textarea
                                    id="systemPrompt"
                                    rows="8"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                ></textarea>
                                <div class="flex justify-between items-center mt-1">
                                    <p class="text-xs text-gray-500">AI-generated system prompt based on your description</p>
                                    <button id="regeneratePromptBtn" class="text-xs text-indigo-600 hover:text-indigo-700">
                                        üîÑ Regenerate
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Download & Deploy -->
                    <div class="step-content" data-step="4">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">üöÄ Step 4: Download & Deploy</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900">
                                <strong>‚úÖ Configuration Complete!</strong> Your AI agent is ready to deploy. Download all files and follow the deployment guide.
                            </p>
                        </div>

                        <div id="configSummary" class="bg-gray-50 rounded-lg p-6 mb-6">
                            <!-- Configuration summary will be inserted here -->
                        </div>

                        <div class="space-y-3">
                            <button id="downloadKBsBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                                üìö Download Knowledge Base Files (.md)
                            </button>
                            <button id="downloadProjectBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                                üìã Download Project Setup Guide
                            </button>
                            <button id="downloadAgentBtn" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                                ü§ñ Download Agent Configuration
                            </button>
                            <button id="downloadAllBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-4 rounded-lg transition-all duration-200">
                                ‚¨áÔ∏è Download All Files
                            </button>

                            <!-- Auto-Deploy Button (Coming Soon) -->
                            <button disabled class="w-full bg-gray-300 text-gray-500 font-semibold py-3 px-4 rounded-lg cursor-not-allowed opacity-60 relative">
                                <span>üöÄ Auto-Deploy to Agent Foundry</span>
                                <span class="ml-2 text-xs bg-gray-400 text-white px-2 py-1 rounded">Coming Soon</span>
                            </button>
                        </div>

                        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-900 mb-2">üìñ Next Steps:</h3>
                            <ol class="list-decimal list-inside text-sm text-blue-800 space-y-1">
                                <li>Download all files to your computer</li>
                                <li>Open Agent Foundry</li>
                                <li>Create new project (use PROJECT_SETUP.md guide)</li>
                                <li>Upload knowledge base files</li>
                                <li>Configure agent (use AGENT_CONFIG.md guide)</li>
                                <li>Test and deploy your agent!</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
                        <button
                            id="prevBtn"
                            class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled
                        >
                            ‚Üê Previous
                        </button>
                        <div class="text-sm text-gray-500">
                            Step <span id="currentStepNum">0</span> of 4
                        </div>
                        <button
                            id="nextBtn"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="claude-api.js"></script>
    <script src="wizard-ai.js"></script>
</body>
</html>
